---
layout: topic
title: Data Visualization
author: Data Carpentry contributors
minutes: 30
---

```{r, echo=FALSE}
metadata <- read.csv('./data/Ecoli_metadata.csv')
```

> ## Learning Objectives {.objectives}
>
> * Basic plots 
> * Advanced plots (introducing `ggplot`)
> * Writing images (and other things) to file

# Basic plots in R

The mathematician Richard Hamming once said, "The purpose of computing is insight, not numbers", and the best way to develop insight is often to visualize data. Visualization deserves an entire lecture (or course) of its own, but we can explore a few features of R's plotting packages.

When we are working with large sets of numbers it can be useful to display that information graphically. R has a number of built-in tools for basic graph types such as hisotgrams, scatter plots, bar charts, boxplots and much [more](http://www.statmethods.net/graphs/). We'll test a few of these out here on the `genome_size` vector from our metadata.

```{r simplestats}
genome_size <- metadata$genome_size
```
(or, equivalently `genome_size <- metadata[ , "genome_size"]` )

## Scatterplot
Let's start with a **scatterplot**. A scatter plot provides a graphical view of the relationship between two sets of numbers. Let's plot `genome_size` as follows:

```{r scatter-plot1, fig.align='center'}
plot(genome_size)
```

Each point represents a value from *metadata*: the y-axis value is the genome size and the x-axis is just the (arbitrary) row number from the *metadata* file (note that this makes the x-axis mostly meaningless in this particular example). Plot features (fonts, colors, axes, titles) can be customized with [graphic options](http://www.statmethods.net/advgraphs/parameters.html)
For example, we can change the shape of the data point using `pch` (`pch` stands for "plot character").

```{r, fig.align='center'}
plot(genome_size, pch=8) # '8' just happens to be an 8-pointed star. Also try pch='X'
```

We can add a title to the plot with `main="Some title here"`:

```{r, fig.align='center'}
plot(genome_size, pch=8, main="Scatter plot of genome sizes")
```

## Histogram
A better way to show distribution of genome sizes is with a histogram, which is `hist` in R:

```{r, fig.align='center'}
hist(genome_size)   # If you want it colorized, try: hist(genome_size, col="red")
```

##Boxplot

Using additional information from our metadata, we can use plots to compare values between the different citrate mutant status using a **boxplot**. A boxplot provides a graphical view of the median, quartiles, maximum, and minimum of a data set.

```{r boxplot, fig.align='center'}
# Boxplot
boxplot(genome_size ~ cit, metadata)
```

**Note:** The first argument to boxplot above (`genome_size ~ cit`) is a bit of an unusual feature of R; it's called a "formula," and in this case, it's being used to pull out the "genome_size" and "cit" columns from the "metadata" object. This isn't crucial to delve into at the moment, but you should know that the `~` is a special feature that generates a "formula" in R--those are not normal variables.

As with the scatterplots, we can add titles, axis labels and colors, and more.

```{r, fig.align='center'}
boxplot(genome_size ~ cit, metadata, col=c("pink","purple", "darkgrey"),
        main="Average expression differences between celltypes", ylab="Expression")
```

# Advanced figures (`ggplot2`)

The advanced plotting package [`ggplot2`](http://docs.ggplot2.org/) adds a lot of functionality to R's plotting.

The syntax takes some getting used to, but it's extremely powerful. Let's re-create some of the above plots with `ggplot` to get a feel for the syntax.

Start by loading the `ggplot2` library.

```{r}
library(ggplot2)
```

The `ggplot()` function is used to initialize the basic graph structure, then we add to it. The basic idea is that you specify different parts of the plot, and combine them into a single plot using the `+` operator.

We will start with a blank plot. (This may generate an error message, and is not expected to do anything useful.)

```{r, eval=FALSE}
ggplot(metadata) # (May generate an error. Does not do anything useful by itself!)
```

Geometric objects (with names liek `geom_something`) are the actual substance of a plot. Simple xamples include `geom_point` for points and `geom_line` for lines.  
* boxplot (`geom_boxplot`, for, well, boxplots!)

A plot **must have at least one geom**; there is no upper limit. You can add a geom to a plot using the + operator

```{r, eval=FALSE}
ggplot(metadata) +
  geom_point() # This also generates and ERROR message! See below for reasons.
```

Each type of `geom` usually has a **required** set of what are called "aesthetics" that must be set with the `aes(...)` function. These include the x and y coordinates of data, the color of data points, and more.

To start, we will add position for the x- and y-axis. (`geom_point` requires x and y coordinates for each point.)

```{r, fig.align='center'}
ggplot(metadata) + geom_point(aes(x=sample, y=genome_size))
# Above: This is the ggplot version of: plot(x=metadata$sample, y=metadata$genome_size) # <-- Try it!
```

The x-axis is ugly, though: the labels are all mashed together. Let's fix that by rotating the labels with a ggplot `theme` layer. (ggplot2 `themes` handle all non-data visual elements, like axis labels, background colors, and figure legends.)

Let's rotate the x-axis labels 45 degrees and move them down a little bit so they don't run into the frame of the plot.

```{r, fig.align='center'}
ggplot(metadata) 
   + geom_point(aes(x=sample, y=genome_size))
   + theme(axis.text.x = element_text(angle=45, hjust=1))
```

That worked! Now we can add in some more options to make an aesthetically-questionable but data-dense figure.

Let's specify the following additional features:
* Color of the points will be determined by `metadata$generation` (i.e. `color=generation`)
* Shape of the points will be determined by `metadata$cit` (i.e. `shape=cit`)
* Point size: make these larger, say, the arbitrary size `3.0`.

```{r, fig.align='center'}
ggplot(metadata) +
  geom_point(aes(x=sample, y=genome_size, color=generation, shape=cit), size=3.0) +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

You can also set the color to a fixed color (instead of having it set based on generation) with, for example, `color="purple"`.

(There are also built-in `ggplot` themes you can use, to avoid having to set all these parameters.)

## Histogram

To plot a histogram we can use ggplot's `geom_histogram`.

```{r, eval=FALSE}
ggplot(metadata) +
  geom_histogram(aes(x=genome_size)) # you can ignore the warning message about 'stat_bin()'
  
```

Try plotting with the default value and compare it to the plot using the binwidth values. How do they differ?

```{r, fig.align='center'}
ggplot(metadata) +
  geom_histogram(aes(x=genome_size), binwidth=0.05) # Feel free to change 'binwidth'
```

## Boxplot

Now let's use `ggplot` to make a plot similar to the plots we made earlier. We can add some additional layers to add a title and custom axis labels. Explore the code below and all the different layers that we have added to understand what each layer contributes to the final graphic.

There's one last ggplot trick below: the command `size=rel(###)` let's you specify a *relative* size: for example, `element_text(size=rel(2.5))` means "make the text 2.5 times larger". This way you don't have to figure out the exact font size you want. If you set "size=2.5," you'll get microscopic text instead!

```{r, fig.align='center'}
ggplot(metadata) +
  geom_boxplot(aes(x=cit, y=genome_size, fill=cit)) +
  ggtitle('Boxplot of genome size by citrate mutant type') +
  xlab('citrate mutant') +
  ylab('genome size') +
  theme(panel.grid.major = element_line(size=0.5, color="grey"),
          axis.text.x = element_text(angle=45, hjust=1),
          axis.title = element_text(size=rel(1.5)),
          axis.text = element_text(size=rel(1.25)))
```

## Writing figures to file

There are two ways in which figures and plots can be output to a file (rather than simply displaying on screen). The first (and easiest) is to export directly from the RStudio 'Plots' panel, by clicking on `Export` when the image is plotted. This will give you the option of `png` or `pdf` and selecting the directory to which you wish to save it to. The second option is to use R functions in the console, allowing you the flexibility to specify parameters to dictate the size and resolution of the output image. Some of the more popular formats include `pdf()`, `png`.

Initialize a plot that will be written directly to a file using `pdf`, `png` etc. Within the function you will need to specify a name for your image, and the with and height (optional). Then create a plot using the usual functions in R. Finally, close the file using the `dev.off()` function. There are also `bmp`, `tiff`, and `jpeg` functions, though the jpeg function has proven less stable than the others.


```{r, eval=FALSE}
pdf("figure/boxplot.pdf")

ggplot(example_data) +
  geom_boxplot(aes(x = cit, y =....) +
  ggtitle(...) +
  xlab(...) +
  ylab(...) +
  theme(panel.grid.major = element_line(...),
          axis.text.x = element_text(...),
          axis.title = element_text(...),
          axis.text = element_text(...)

dev.off()
```




Resources:
---------
We have only scratched the surface here. To learn more, see the [ggplot reference site](http://docs.ggplot2.org/), and Winston Chang's excellent [Cookbook for R](http://wiki.stdout.org/rcookbook/Graphs/) site. Though slightly out of date, [ggplot2: Elegant Graphics for Data Anaysis](http://www.amazon.com/ggplot2-Elegant-Graphics-Data-Analysis/dp/0387981403) is still the definative book on this subject. Much of the material here was adpapted from [Introduction to R graphics with ggplot2 Tutorial at IQSS](http://tutorials.iq.harvard.edu/R/Rgraphics/Rgraphics.html).
